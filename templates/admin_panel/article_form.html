{% extends 'admin_panel/base.html' %}

{% block title %}{{ action }} Article{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-content">
        <h1 class="page-title">{{ action }} Article</h1>
        <p class="page-subtitle">Create or edit article content</p>
    </div>
    <div class="page-header-actions">
        <a href="{% url 'admin_panel:article_list' %}" class="btn btn-ghost">‚Üê Back to Articles</a>
    </div>
</div>

<div class="form-container">
    <form method="post" class="admin-form" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="form-group form-group-large">
                <label for="title">Title *</label>
                <input type="text" id="title" name="title" value="{% if article %}{{ article.title }}{% endif %}" required placeholder="Enter article title">
            </div>
            <div class="form-group">
                <label for="slug">Slug</label>
                <input type="text" id="slug" name="slug" value="{% if article %}{{ article.slug }}{% endif %}" placeholder="auto-generated-from-title">
                <span class="form-hint">Leave empty to auto-generate from title</span>
            </div>
        </div>
        
        <div class="form-group">
            <label for="excerpt">Excerpt</label>
            <textarea id="excerpt" name="excerpt" rows="2" placeholder="Brief description of the article">{% if article %}{{ article.excerpt }}{% endif %}</textarea>
        </div>
        
        <div class="form-group">
            <label for="content">Content *</label>
            <textarea id="content" name="content" rows="10" required placeholder="Write your article content here (HTML supported)">{% if article %}{{ article.content }}{% endif %}</textarea>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" name="category" required>
                    <option value="">Select Category</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if article and article.category.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="subcategory">Subcategory</label>
                <select id="subcategory" name="subcategory">
                    <option value="">Select Subcategory</option>
                    {% for sub in subcategories %}
                    <option value="{{ sub.id }}" {% if article and article.subcategory.id == sub.id %}selected{% endif %}>{{ sub.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="author">Author</label>
                <input type="text" id="author" name="author" value="{% if article %}{{ article.author }}{% else %}Healthline Team{% endif %}" placeholder="Author name">
            </div>
            <div class="form-group">
                <label for="read_time">Read Time (minutes)</label>
                <input type="number" id="read_time" name="read_time" value="{% if article %}{{ article.read_time }}{% else %}5{% endif %}" min="1">
            </div>
        </div>
        
        <div class="form-section">
            <h3 class="form-section-title">Article Image</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="image_upload">Upload Image</label>
                    <input type="file" id="image_upload" name="image_upload" accept="image/*">
                    <span class="form-hint">Upload an image from your device (JPG, PNG, SVG)</span>
                    {% if article and article.image %}
                    <div class="current-image">
                        <p>Current uploaded image: {{ article.image.name }}</p>
                    </div>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="image_url">Or Enter Image Path/URL</label>
                    <input type="text" id="image_url" name="image_url" value="{% if article %}{{ article.image_url }}{% endif %}" placeholder="e.g., images/articles/placeholder.svg">
                    <span class="form-hint">Enter a relative path or URL for the image</span>
                </div>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_featured" {% if article and article.is_featured %}checked{% endif %}>
                    <span>Featured Article</span>
                </label>
                <span class="form-hint">Featured articles appear on homepage</span>
            </div>
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_trending" {% if article and article.is_trending %}checked{% endif %}>
                    <span>Trending Article</span>
                </label>
                <span class="form-hint">Trending articles appear in trending section</span>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                    <option value="published" {% if article and article.status == 'published' %}selected{% endif %}>Published</option>
                    <option value="draft" {% if article and article.status == 'draft' %}selected{% endif %}>Draft</option>
                </select>
                <span class="form-hint">Draft articles are not visible to public</span>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{{ action }} Article</button>
            <a href="{% url 'admin_panel:article_list' %}" class="btn btn-ghost">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-generate slug from title
document.getElementById('title').addEventListener('input', function() {
    const slugInput = document.getElementById('slug');
    if (!slugInput.value) {
        const slug = this.value
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/(^-|-$)/g, '');
        slugInput.value = slug;
    }
});

// Load subcategories based on category selection
document.getElementById('category').addEventListener('change', function() {
    const categoryId = this.value;
    const subcategorySelect = document.getElementById('subcategory');
    
    if (categoryId) {
        fetch(`/admin/api/subcategories/?category_id=${categoryId}`)
            .then(response => response.json())
            .then(data => {
                subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
                data.subcategories.forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.id;
                    option.textContent = sub.name;
                    subcategorySelect.appendChild(option);
                });
            });
    } else {
        subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
    }
});
</script>
{% endblock %}
